!function(A){"use strict";var h=A.ht,W=h.Default,n=W.getInternal(),s=n.ui(),O=null,x="__segmentLengths",a="__lineTotalLength",_="__linePoints",F="__distance0",e="flow.count",J="flow.step",U="flow.element.max",q="flow.element.count",v="flow.element.min",i="flow.element.space",C="flow.element.autorotate",L="flow.element.background",Q="flow.element.shadow.max",z="flow.element.shadow.min",r="flow.element.shadow.begincolor",I="flow.element.shadow.endcolor",S="flow.element.shadow.visible",t="flow.element.image",g="flow",c=h.Math.Vector2,y=new c;new c,new c,h.List;var p=h.Default._edgeProtectMethod,E=p.getStraightLinePoints,R=function(C,x){for(var e=[],j=C.length,d=0;j>d;d++){var R=C[d];R._as&&(R=R._as);for(var H=R[0],v=1;v<R.length;v++)e.push([H,R[v]]),H=R[v]}for(var B=[],d=0;d<e.length;d++){var J=M(e[d][0],e[d][1],x);B.push(J)}return{distance:B,segments:e}},T=function(V,Q,C){if(V){for(var u,I=R(V,Q),U=I.distance,g=I.segments,x=1/0,f=null,z=0,v=U.length;v>z;z++){var c=U[z];c.z<x&&(u=z,x=c.z,f=c)}if(null==C&&(C=.1),f.z<C){for(var S=0,A=0;u>=A;A++)S+=W.getDistance(g[A][0],u>A?g[A][1]:f);return S}}},M=function(c,O,m){var N=c.x,Y=c.y,u=O.x,a=O.y,D=m.x,j=m.y,K=u-N,i=a-Y,v=Math.sqrt(K*K+i*i),g=K/v,s=i/v,$=(-N+D)*g+(-Y+j)*s,y={x:N+$*g,y:Y+$*s};return y.x>=Math.min(c.x,O.x)&&y.x<=Math.max(c.x,O.x)&&y.y>=Math.min(c.y,O.y)&&y.y<=Math.max(c.y,O.y)||(y.x=Math.abs(y.x-c.x)<Math.abs(y.x-O.x)?c.x:O.x,y.y=Math.abs(y.y-c.y)<Math.abs(y.y-O.y)?c.y:O.y),K=D-y.x,i=j-y.y,y.z=Math.sqrt(K*K+i*i),y},D=function(D,$){if(D){var S=R(D,$).distance,o=1/0,I=null;return S.forEach(function(B){B.z<o&&(o=B.z,I=B)}),I}},w=p.calculateLineLength,m=p.calcSegmentIndexByDistance,P=p.calculatePointAlongLine,Z=function(a,g,A){if(!a)return A;if(0===g){var v=a[0][0],q=a[0][1];return A+Math.atan2(q.y-v.y,q.x-v.x)}if(100===g){a=a[a.length-1];var v=a[a.length-2],q=a[a.length-1];return A+Math.atan2(q.y-v.y,q.x-v.x)}for(var t=0,d=[],B=a.length,Y=0;B>Y;Y++){var x=a[Y],$=w(x);t+=$,d.push($)}for(var G=t*g/100,p=m(G,d),l=0,c=0;p>c;c++)l+=d[c];G-=l;for(var I=P(a[p],G),k=a[p],y=0,W=0,n=0;n<k.length-1;n++){var U=k[n],Q=k[n+1],z=Q.x-U.x,S=Q.y-U.y,i=Math.sqrt(z*z+S*S);if(y+=i,y>G){W=n;break}}var J=k[W];return A+Math.atan2(I.y-J.y,I.x-J.x)},H=function(h){var z=0;if(h)if(Array.isArray(h[0]))for(var C=h.length,n=0;C>n;n++){var A=h[n],P=w(A);z+=P}else z=w(h);return z},X=function(i,h,m,S){return y.set(h,m).rotateAround(null,S),i?{x:i.x+y.x,y:i.y+y.y}:{x:y.x,y:y.y}},j=function(J){var q=J._data,m=E(J);if(m){q.s("flow.reverse")&&(m.reverse(),m.forEach(function(l){l.reverse()}));for(var P=0,e=[],Y=m.length,A=0;Y>A;A++){var G=m[A],z=w(G);P+=z,e.push(z)}if(q[x]=e,q[a]=P,q[_]=m,q instanceof h.Edge){var o=W.unionPoint(m),k=o.x+o.width/2,u=o.y+o.height/2;q.$10e={x:k,y:u}}$(J,!0)}},d=p.getPercentPosition,$=function(V,z){var K=V._data,A=K[a],P=K.s(e),$=K.s(J),c=0,p=K[x],y=K.s(U),t=K.s(v),n=K.s(q),h=(y-t)/(n-1),o=[];if(p){if(1===n)o.push(y);else if(2===n)o.push(y),o.push(t);else{if(!(n>2))return;o.push(y);for(var s=n-2;s>0;s--)o.push(t+h*s);o.push(t)}var f=0,g=0;o.forEach(function(Y){n-1>f&&(g+=K.getFlowElementSpace(Y)),f++}),g+=(y+t)/2,c=(A-P*g+g)/P;var L=V[F];for(null==L&&(L=0),z||(L+=$);L>A+g;){var D=V._overCount;D?D++:D=1,D>=P&&(D=null),V._overCount=D,K.s("flow.autoreverse")?D?L-=c+g:(L=0,K.s("flow.reverse",!K.s("flow.reverse"))):L-=c+g}V[F]=L}},B="prototype",K=h.graph.GraphView[B],b=h.Data[B],f=s.DataUI[B],k=s.ShapeUI[B],o=s.EdgeUI[B],l=h.DataModel[B],V=h.Style;V[U]==O&&(V[U]=7),V[v]==O&&(V[v]=0),V[e]==O&&(V[e]=1),V[J]==O&&(V[J]=3),V[q]==O&&(V[q]=10),V[i]==O&&(V[i]=3.5),V[C]==O&&(V[C]=!1),V[L]==O&&(V[L]="rgba(255, 255, 114, 0.4)"),V[r]==O&&(V[r]="rgba(255, 255, 0, 0.3)"),V[I]==O&&(V[I]="rgba(255, 255, 0, 0)"),V[S]==O&&(V[S]=1),V[Q]==O&&(V[Q]=22),V[z]==O&&(V[z]=4),K.calculatePointLength=function(M,v,m){var f=this.getDataUI(M),i=E(f);return T(i,v,m)},W.calculatePointLength=function(B,G,t,A){var b=E(O,B,G);return T(b,t,A)},W.calculateClosestPointOnLine=M,K.calculateClosestPoint=function(f,O){var i=this.getDataUI(f),z=E(i);return D(z,O)},W.calculateClosestPoint=function(I,w,W){var A=E(O,I,w);return D(A,W)},K.getPercentAngle=function(P,j){var O=this.getDataUI(P),g=E(O);return P.getRotation?P.getRotation():0,Z(g,j,P.getRotation?P.getRotation():0)},W.getPercentAngle=function(N,U,Q){var a=E(O,N,U);return Z(a,Q,0)},K.calculateLength=function(J){var u=this.getDataUI(J),m=E(u);return H(m)},W.calculateLength=function(i,B){var Z=E(O,i,B);return H(Z)},K.getPercentPosition=function(Q,t){var l=this.getDataUI(Q),V=E(l);return d(V,t)},W.getPercentPositionOnPoints=function(V,C,s){var f=E(O,V,C);return d(f,s)};var Y=function(p){var k=p.data,Q=this.dm();if(k&&"add"===p.kind){var c=Q.$3e;c&&k.s(g)&&c.indexOf(k)<0&&c.push(k)}"clear"===p.kind&&(Q.$3e=[])},N=function(o){var h=o.property,$=o.data,i=o.newValue,j=this.dm().$3e;if(j&&"s:flow"===h)if(i)j.indexOf($)<0&&j.push($);else for(var O=j.length,E=0;O>E;E++)if(j[E]===$){j.splice(E,1);break}},G=K.setDataModel;K.setDataModel=function(s){var W=this,l=W._dataModel;if(l!==s){l&&(l.umm(Y,W),l.umd(N,W),l.$3e=[]),s.mm(Y,W),s.md(N,W);var C=s.$3e=[];s.each(function(M){M.s(g)&&C.indexOf(M)<0&&C.push(M)}),G.call(W,s)}},b.getFlowElementSpace=function(){return this.s(i)};var u=function(s){var B=this,w=B._data,g=w[a],t=w[x],H=w[_],K=w.s(e),A=0,r=B[F],M=w.s(U),N=w.s(v),W=w.s(q),c=w.s(z),b=w.s(Q),j=w.s(C),V=(b-c)/(W-1),J=(M-N)/(W-1),I=w.getRotation?w.getRotation():0,y=w.getPosition?w.p():w.$10e,Z=[],G=[];if(r!=O){if(1===W)Z.push(M);else if(2===W)Z.push(M),Z.push(N);else{if(!(W>2))return;Z.push(M);for(var D=W-2;D>0;D--)Z.push(N+J*D);Z.push(N)}if(1===W)G.push(b);else if(2===W)G.push(b),G.push(c);else{if(!(W>2))return;G.push(b);for(var D=W-2;D>0;D--)G.push(c+V*D);G.push(c)}var l=0,S=0;Z.forEach(function(T){W-1>l&&(S+=w.getFlowElementSpace(T)),l++}),S+=(M+N)/2,A=(g-K*S+S)/K,s.save();for(var D=0;K>D;D++){var i=r,$=0,n=B._overCount,R=0;w.s("flow.autoreverse")&&n&&n>K-(D+1)||(i-=D*(A+S),l=0,Z.forEach(function(W){var U=i-$;if(U>=0&&g>U){var r=!0,q=m(U,t);R=0;for(var L=0;q>L;L++)R+=t[L];if(U-=R,r){var J=P(H[q],U),V=I;if(j){for(var Q=H[q],F=0,O=0,C=0;C<Q.length-1;C++){var c=Q[C],d=Q[C+1],S=d.x-c.x,D=d.y-c.y,h=Math.sqrt(S*S+D*D);if(F+=h,F>U){O=C;break}}var f=Q[O];V+=Math.atan2(J.y-f.y,J.x-f.x)}I&&(J=X(y,J.x-y.x,J.y-y.y,I)),B.$5e(s,J,W,G[l],V)}}$+=w.getFlowElementSpace(Z[l]),l++}))}s.restore()}},Io=o._80o;o._80o=function(H){Io.call(this,H);var P=this,f=P._data,Z=P.gv;f.s(g)&&Z.$7e!=O&&u.call(P,H)};var dm=k._80o;k._80o=function(W){dm.call(this,W);var j=this,A=j._data,I=j.gv;A.s(g)&&I.$7e!=O&&u.call(j,W)};var zn=o._79o,Nh=k._79o,tk=function(){var z=this,w=z._data,c=w.s(U),E=!1,L=O;if(z._6I||(E=!0),L=w instanceof h.Edge?zn.call(z):Nh.call(z),w.s(g)&&E){var t=w.s(Q),B=w.s(S);B&&t>c&&(c=t),c>0&&W.grow(L,Math.ceil(c/2)),j(z)}return!w.s(g)&&E&&(w[x]=w[a]=w[_]=z[F]=O),L};k._79o=tk,o._79o=tk,f.$5e=function(J,y,F,f,o){var A=this,p=A._data,G=A.gv,R=p.s(L),b=p.s(r),Q=p.s(I),B=p.s(S),v=G.$8e,e=p.s(t);if(v==O&&(v=G.$8e={}),J.beginPath(),e!=O){var T=W.getImage(e),w=F/2;J.translate(y.x,y.y),J.rotate(o),J.translate(-y.x,-y.y),W.drawImage(J,T,y.x-w,y.y-w,F,F,p),J.translate(y.x,y.y),J.rotate(-o),J.translate(-y.x,-y.y)}else if(G.__flowBatch){var V=G.__flowBatchGroup;V||(V=G.__flowBatchGroup={});var Z=[y.x,y.y,F/2];V[R]?V[R].push(Z):V[R]=[Z]}else J.fillStyle=R,J.arc(y.x,y.y,F/2,0,2*Math.PI,!0),J.fill();if(B){var u=22,j=u+"_"+b+"_"+Q,U=v[j];if(U==O){var k=document.createElement("canvas");n.setCanvas(k,u,u);var N=k.getContext("2d"),P=u/2,h=P,q=P;n.translateAndScale(N,0,0,1),N.beginPath();var M=N.createRadialGradient(h,q,0,h,h,P);M.addColorStop(0,b),M.addColorStop(1,Q),N.fillStyle=M,N.arc(h,q,P,0,2*Math.PI,!0),N.fill(),U=v[j]=k}var w=f/2;W.drawImage(J,U,y.x-w,y.y-w,f,f,p)}},K.$9e=function(){var K=this,Z=K.dm().$3e;K._24I,Z.forEach(function(v){K._24I[v._id]=v}),K.iv()};var ak=l.prepareRemove;l.prepareRemove=function($){ak.call(this,$);var V=$._dataModel,U=V.$3e;if(U)for(var s=U.length,l=0;s>l;l++)if(U[l]===$){U.splice(l,1);break}},K.setFlowInterval=function(v){var Y=this,n=Y.$11e;Y.$11e=v,Y.fp("flowInterval",n,v),Y.$7e!=O&&(clearInterval(Y.$7e),delete Y.$7e,Y.enableFlow(v))},K.getFlowInterval=function(){return this.$11e},K.enableFlow=function(G){var R=this,d=R.dm(),M=d.$3e;R.$7e==O&&(M.forEach(function(F){var N=R.getDataUI(F);j(N)}),R.$7e=setInterval(function(){d.$3e.forEach(function(K){$(R.getDataUI(K))}),R.$9e()},G||R.$11e||50))},K.disableFlow=function(){var I=this;clearInterval(I.$7e),delete I.$7e;var y=I.dm().$3e;y&&I.$9e()};var zf=function(){this.__flowBatchGroup={}},mg=function(U){var l=this.__flowBatchGroup;if(l){U.save();for(var P in l){U.fillStyle=P,U.beginPath();var d=l[P];d.forEach(function(P){U.moveTo(P[0],P[1]),U.arc(P[0],P[1],P[2],0,2*Math.PI,!0)}),U.fill()}U.restore()}};K.setFlowBatch=function(c){var B=this;!!B.__flowBatch!=!!c&&(B.__flowBatch=c,c?(B.addBottomPainter(zf),B.addTopPainter(mg)):(B.removeBottomPainter(zf),B.removeTopPainter(mg)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);