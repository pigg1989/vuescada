!function(E,e){"use strict";var L=ht.AlarmSeverity=function(j,b,G,_,v){this.value=j,this.name=b,this.nickName=G,this.color=_,this.displayName=v};ht.Default.def("ht.AlarmSeverity",e,{toString:function(){return this.displayName||this.name}}),function(){L.severities=new ht.List,L._vm={},L._nm={},L._cp=function(w,g){if(w&&g){var L=w.value-g.value;return L>0?1:0>L?-1:0}return w&&!g?1:!w&&g?-1:0},L.each=function($,c){L.severities.each($,c)},L.getSortFunction=function(){return L._cp},L.setSortFunction=function(H){L._cp=H,L.severities.sort(H)},L.add=function(Y,t,M,H,z){var g=new L(Y,t,M,H,z);return L._vm[Y]=g,L._nm[t]=g,L.severities.add(g),L.severities.sort(L._cp),g},L.remove=function(O){var w=L._nm[O];return w&&(delete L._nm[O],delete L._vm[w.value],L.severities.remove(w)),w},L.CRITICAL=L.add(500,"Critical","C","#FF0000"),L.MAJOR=L.add(400,"Major","M","#FFA000"),L.MINOR=L.add(300,"Minor","m","#FFFF00"),L.WARNING=L.add(200,"Warning","W","#00FFFF"),L.INDETERMINATE=L.add(100,"Indeterminate","N","#C800FF"),L.CLEARED=L.add(0,"Cleared","R","#00FF00"),L.isClearedAlarmSeverity=function(A){return A?0===A.value:!1},L.getByName=function(K){return L._nm[K]},L.getByValue=function(O){return L._vm[O]},L.clear=function(){L.severities.clear(),L._vm={},L._nm={}},L.compare=function(t,P){return L._cp(t,P)}}();var u=ht.AlarmState=function(M){this._d=M,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",e,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var T=null;for(var p in this._am)p=L.getByName(p),L.isClearedAlarmSeverity(p)||0!==this.getAcknowledgedAlarmCount(p)&&(T=T?L.compare(T,p)>0?T:p:p);this._haa=T},_c2:function(){var g=null;for(var t in this._nm)t=L.getByName(t),L.isClearedAlarmSeverity(t)||0!==this.getNewAlarmCount(t)&&(g=g?L.compare(g,t)>0?g:t:t);this._hna=g},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var W in this._nm)if(W=L.getByName(W),!L.isClearedAlarmSeverity(W)&&0!==this.getNewAlarmCount(W)&&L.compare(this._hna,W)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var A=this._haa,Y=this._hna,d=this._ps;this._hoa=A,L.compare(Y,this._hoa)>0&&(this._hoa=Y),L.compare(d,this._hoa)>0&&(this._hoa=d)},_c5:function(){var r=this._haa,u=this._hna;this._hta=r,L.compare(u,this._hta)>0&&(this._hta=u)},increaseAcknowledgedAlarm:function(J,a){if(0!==a){a=a||1;var F=this._am[J.name]||0;F+=a,this._am[J.name]=F,this._f()}},increaseNewAlarm:function(Q,l){if(0!==l){l=l||1;var x=this._nm[Q.name]||0;x+=l,this._nm[Q.name]=x,this._f()}},decreaseAcknowledgedAlarm:function(r,R){if(0!==R){R||(R=1);var K=this._am[r.name]||0;if(K-=R,0>K)throw"Alarm count can not be negative";this._am[r.name]=K,this._f()}},decreaseNewAlarm:function(i,W){if(0!==W){W||(W=1);var B=this._nm[i.name]||0;if(B-=W,0>B)throw"Alarm count can not be negative";this._nm[i.name]=B,this._f()}},acknowledgeAlarm:function(Z){this.decreaseNewAlarm(Z,1),this.increaseAcknowledgedAlarm(Z,1)},acknowledgeAllAlarms:function(B){if(B){var l=this.getNewAlarmCount(B);this.decreaseNewAlarm(B,l),this.increaseAcknowledgedAlarm(B,l)}else for(var m in this._nm)this.acknowledgeAllAlarms(L.getByName(m))},_c6:function(){this._aac=0;for(var S in this._am)S=L.getByName(S),this._aac+=this.getAcknowledgedAlarmCount(S)},getAcknowledgedAlarmCount:function(Y){return Y?this._am[Y.name]||0:this._aac},getAlarmCount:function(P){return this.getAcknowledgedAlarmCount(P)+this.getNewAlarmCount(P)},_c7:function(){this._nac=0;for(var N in this._nm)this._nac+=this.getNewAlarmCount(L.getByName(N))},getNewAlarmCount:function(S){return S?this._nm[S.name]||0:this._nac},setNewAlarmCount:function(Q,l){this._nm[Q.name]=l,this._f()},removeAllNewAlarms:function(q){q?delete this._nm[q]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(i,O){this._am[i.name]=O,this._f()},removeAllAcknowledgedAlarms:function(V){V?delete this._am[V.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(u){if(this._ep||(u=null),this._ps!==u){var x=this._ps;this._ps=u,this._f(),this._d.fp("propagateSeverity",x,u)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(I){var L=this._ep;this._ep=I,this._d.fp("enablePropagation",L,I)&&(I||this.setPropagateSeverity(null))}});var X=ht.AlarmStatePropagator=function(b){this._dataModel=b,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",e,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(w){this._enable!==w&&(this._enable=w,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(G){this.propagate(G)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(k){k.data&&this.propagate(k.data)},handleDataPropertyChange:function(G){if("alarmState"===G.property||"enablePropagation"===G.property)this.propagate(G.data);else if("parent"===G.property){var n=G.oldValue;n&&this.propagate(n),this.propagate(G.data)}},propagate:function(L){L&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(L),this._isPropagating=!1)},propagateToTop:function(n){for(this.propagateToParent(null,n);n&&n.getParent();)this.propagateToParent(n,n.getParent()),n=n.getParent()},propagateToParent:function(x,v){var A=null;v.getChildren().each(function(C){var t=C.getAlarmState().getHighestOverallAlarmSeverity();L.compare(t,A)>0&&(A=t)}),v.getAlarmState().setPropagateSeverity(A)}}),ht.AlarmStateStatistics=function(D){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(D)},ht.Default.def("ht.AlarmStateStatistics",e,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(n){var p=this._dataModel;p!==n&&(p&&(p.umd(this.handleDataPropertyChange,this),p.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=n,this.reset(),n.md(this.handleDataPropertyChange,this),n.mm(this.handleDataModelChange,this),this.fp("dataModel",p,n))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(X){"alarmState"===X.property&&(this.increase(X.data),this.fireAlarmStateChange())},handleDataModelChange:function(p){"add"===p.kind?(this.increase(p.data),this.fireAlarmStateChange()):"remove"===p.kind?(this.decrease(p.data),this.fireAlarmStateChange()):"clear"===p.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,L.each(function(H){var G=this.getSumInfo(H);this.sumAcked+=G.ackedCount,this.sumNew+=G.newCount,this.sumTotal+=G.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(C){if(!C)return this.sumNew;var o=this.getSumInfo(C);return o.newCount},getAcknowledgedAlarmCount:function(D){if(!D)return this.sumAcked;var C=this.getSumInfo(D);return C.ackedCount},getTotalAlarmCount:function(y){if(!y)return this.sumTotal;var v=this.getSumInfo(y);return v.totalCount},getSumInfo:function(a){var J=this.severtiyMap[a.name];return J||(J={},J.newCount=0,J.ackedCount=0,J.totalCount=0,this.severtiyMap[a.name]=J),J},decrease:function(h){var K=this.dataMap[h.getId()];K&&(delete this.dataMap[h.getId()],L.each(function(o){var A=K[o.name],d=this.getSumInfo(o);d.newCount=d.newCount-A.newCount,d.ackedCount=d.ackedCount-A.ackedCount,d.totalCount=d.totalCount-A.totalCount},this))},increase:function(W){if(this.decrease(W),!this._filterFunc||this._filterFunc(W)){var b={},q=W.getAlarmState();this.dataMap[W.getId()]=b,L.each(function(K){var k={};k.newCount=q.getNewAlarmCount(K),k.ackedCount=q.getAcknowledgedAlarmCount(K),k.totalCount=q.getAlarmCount(K),b[K.name]=k;var N=this.getSumInfo(K);N.newCount=N.newCount+k.newCount,N.ackedCount=N.ackedCount+k.ackedCount,N.totalCount=N.totalCount+k.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(n){var d=this._filterFunc;this._filterFunc=n,this.reset(),this.fp("filterFunc",d,n)},getFilterFunc:function(){return this._filterFunc}});var B=ht.Data.prototype;B.getAlarmState=function(){return this._alarmState||(this._alarmState=new u(this))},B=ht.DataModel.prototype,B.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},B.setEnableAlarmStatePropagator=function(Q){Q!=this.isEnableAlarmStatePropagator()&&(Q?(this._alarmStatePropagator=new X(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},B=ht.graph.GraphView.prototype,B.getNote2=function(W){var K=W.getAlarmState().getHighestNewAlarmSeverity();if(K){var P=W.getAlarmState().getNewAlarmCount(K)+K.nickName;return W.getAlarmState().hasLessSevereNewAlarms()&&(P+="+"),P}return W.s("note2")},B.getNote2Background=function(s){var x=s.getAlarmState().getHighestNewAlarmSeverity();return x?x.color:s.s("note2.background")},B.getBodyColor=function(v){var b=v.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:v.s("body.color")},B.getBorderColor=function(w){var G=w.getAlarmState().getPropagateSeverity();return G?G.color:w.s("border.color")},B=ht.widget.TreeView.prototype,B.getBorderColor=function(b){var U=b.getAlarmState().getPropagateSeverity();return U?U.color:b.s("border.color")},B.getIcon=function(o){return o.getIcon()?"__alarmIcon__":null},B=ht.widget.TreeTableView.prototype,B.getBorderColor=function(x){var R=x.getAlarmState().getPropagateSeverity();return R?R.color:x.s("border.color")},B.getIcon=function(t){return t.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(y){return y.getIcon()}},color:{func:function(U){var n=U.getAlarmState().getHighestNativeAlarmSeverity();return n?n.color:U.s("body.color")}},rect:[0,0,16,16]}]});var q=ht.Style;q["note2.expanded"]=!0,q["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);