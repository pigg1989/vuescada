!function(S,Y){"use strict";var Q="ht",r=Q+".layout.",s=S[Q]||module.parent.exports.ht,N=s.List,i=s.DataModel,H=s.Node,F=s.Edge,C=s.Group,R=Math,n=R.sqrt,e=R.random,m=R.max,f=R.min,Z=function(i){return i*i};s.Default.getInternal().addMSMap({ms_force:function(X){X._interval=50,X._stepCount=10,X._motionLimit=.01,X._edgeRepulsion=.65,X._nodeRepulsion=.65,X._damper=1,X._maxMotion=0,X._motionRatio=0,X.init=function(X){var P=this;X instanceof i?P.dm=X:P.gv=X,P._nodeMap={},P._nodes=new N,P._edges=new N},X.start=function(){var h=this,c=h.gv;if(!h._timer){var Y=h.cdm=c?c.dm():h.dm;Y.mm(h.handleDataModelChange,h),Y.md(h.handleDataPropertyChange,h),c&&c.mp(h.handleGV,h),Y.each(function(b){if(h.isVisible(b)&&h.isLayoutable(b)&&b instanceof H)if(h instanceof x){var c=b.p3();b.p3([c[0]+e(),c[1]+e(),c[2]+e()])}else c=b.p(),b.p(c.x+e(),c.y+e())}),h._timer=setInterval(function(){h.relax()},h._interval),h._damper=1}},X.stop=function(){var p=this;p._timer&&(p.cdm.umm(p.handleDataModelChange,p),p.cdm.umd(p.handleDataPropertyChange,p),p.gv&&p.gv.ump(p.handleGV,p),clearInterval(p._timer),delete p._timer,delete p.cdm)},X.handleGV=function(m){var C=this;if("dataModel"===m.property){var o=m.oldValue,n=m.newValue;o&&(o.umm(C.handleDataModelChange,C),o.umd(C.handleDataPropertyChange,C)),this.cdm=n,n.mm(C.handleDataModelChange,C),n.md(C.handleDataPropertyChange,C)}},X.relax=function(){var E=this;if(!(E._damper<.1&&E._maxMotion<E._motionLimit)){this.cdm.each(function(U){E.isVisible(U)&&(U instanceof F?E.addEdge(U):U instanceof H&&E.addNode(U))});for(var r,Y,C=0,W=E._edges,O=E._nodes,l=O.size();C<E._stepCount;C++){for(W.each(E.relaxEdge,E),r=0;l>r;r++)for(Y=0;l>Y;Y++)E.relaxNode(O.get(r),O.get(Y));E.moveNode()}E._isAdjusting=1,O.each(function(O){O.fix||(O.p?O.v.p3(O.p):O.v.p(O.x,O.y))}),delete E._isAdjusting,E._nodeMap={},O.clear(),W.clear(),E.onRelaxed()}},X.onRelaxed=function(){},X.isRunning=function(){return!!this._timer},X.isVisible=function(Q){return Q.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(Q):!0},X.isLayoutable=function(O){if(O.s("layoutable")===!1)return!1;if(O instanceof C)return!1;var l=this;return l.gv?l.gv.isMovable(O)&&!l.gv.isSelected(O):!(l.cdm||l.dm).sm().co(O)},X.getNodeRepulsion=function(){return this._nodeRepulsion},X.setNodeRepulsion=function(F){this._nodeRepulsion=F,this._damper=1},X.getEdgeRepulsion=function(){return this._edgeRepulsion},X.setEdgeRepulsion=function(l){this._edgeRepulsion=l,this._damper=1},X.getStepCount=function(){return this._stepCount},X.setStepCount=function(z){this._stepCount=z,this._damper=1},X.getInterval=function(){return this._interval},X.setInterval=function(V){var f=this;f._interval!==V&&(f._interval=V,f._timer&&(clearInterval(f._timer),f._timer=setInterval(function(){f.relax()},V)))},X.handleDataPropertyChange=function(c){!this._isAdjusting&&this.isVisible(c.data)&&(this._damper=1)},X.handleDataModelChange=function(){this._damper=1},X.damp=function(){var o=this._maxMotion,u=this._damper;this._motionRatio<=.001&&((.2>o||o>1&&.9>u)&&u>.01?this._damper-=.01:.4>o&&u>.003?this._damper-=.003:u>1e-4&&(this._damper-=1e-4)),o<this._motionLimit&&(this._damper=0)}}}),s.layout.ForceLayout=function(M){this.init(M)},s.Default.def(r+"ForceLayout",Y,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(J){this._limitBounds=J,this._damper=1},getNodeSize:function(g){var n=this.gv;return n&&n.getDataUIBounds?n.getDataUIBounds(g):g.getRect()},addNode:function(I){var W=this,c=W._nodeMap[I._id];if(c)return c;var k=I.p();c={v:I,x:k.x,y:k.y,dx:0,dy:0,fix:!W.isLayoutable(I),s:W.getNodeSize(I)};var V=c.s,E=n(Z(V.width)+Z(V.height))*W._nodeRepulsion;return c.r=1>E?100:E,W._nodeMap[I._id]=c,W._nodes.add(c),c},addEdge:function(s){if(s._40I&&s._41I){var D=this,E=D.addNode(s._40I),Y=D.addNode(s._41I),b={s:E,t:Y};Y=Y.s,E=E.s;var M=Y.width+E.width,r=Y.height+E.height;b.length=n(M*M+r*r)*D._edgeRepulsion,b.length<=0&&(b.length=100),D._edges.add(b)}},relaxEdge:function(I){var L=I.t,U=I.s,y=L.x-U.x,v=L.y-U.y,k=n(y*y+v*v),S=100*I.length,T=.25*y/S*k,R=.25*v/S*k;L.dx=L.dx-T,L.dy=L.dy-R,U.dx=U.dx+T,U.dy=U.dy+R},relaxNode:function(G,h){if(G!==h){var B=0,u=0,v=G.x-h.x,R=G.y-h.y,U=v*v+R*R;0===U?(B=e(),u=e()):36e4>U&&(B=v/U,u=R/U);var c=G.r*h.r/400;B*=c,u*=c,G.dx+=B,G.dy+=u,h.dx-=B,h.dy-=u}},moveNode:function(){var w=this,Z=w._limitBounds,c=w._maxMotion,z=0,X=w._damper;w._nodes.each(function(V){if(!V.fix){var c=V.dx*X,e=V.dy*X;if(V.dx=c/2,V.dy=e/2,z=m(n(c*c+e*e),z),V.x+=m(-40,f(40,c)),V.y+=m(-40,f(40,e)),Z){V.x<Z.x&&(V.x=Z.x,w.adjust(1,0)),V.y<Z.y&&(V.y=Z.y,w.adjust(0,1));var k=V.s;V.x+k.width>Z.x+Z.width&&(V.x=Z.x+Z.width-k.width,w.adjust(-1,0)),V.y+k.height>Z.y+Z.height&&(V.y=Z.y+Z.height-k.height,w.adjust(0,-1))}}}),w._maxMotion=z,w._motionRatio=z>0?c/z-1:0,w.damp()},adjust:function(L,$){var g=this._limitBounds;this._nodes.each(function(E){L>0?(!g||E.x+E.s.width+L<g.x+g.width)&&(E.x+=L):(!g||E.x+L>g.x)&&(E.x+=L),$>0?(!g||E.y+E.s.height+$<g.y+g.height)&&(E.y+=$):(!g||E.y+$>g.y)&&(E.y+=$)})}});var x=s.layout.Force3dLayout=function(j){this.init(j)};s.Default.def(r+"Force3dLayout",Y,{ms_force:1,getNodeSize3d:function(E){return E.s3()},addNode:function(c){var I=this,q=I._nodeMap[c._id];if(q)return q;q={v:c,p:c.p3(),d:[0,0,0],fix:!I.isLayoutable(c),s:I.getNodeSize3d(c)};var a=q.s,m=s.Default.getDistance(a)*I._nodeRepulsion;return q.r=1>m?100:m,I._nodeMap[c._id]=q,I._nodes.add(q),q},addEdge:function(R){if(R._40I&&R._41I){var z=this,d=z.addNode(R._40I),k=z.addNode(R._41I),V={s:d,t:k};k=k.s,d=d.s,V.length=n(Z(k[0]+d[0])+Z(k[1]+d[1])+Z(k[2]+d[2]))*z._edgeRepulsion,V.length<=0&&(V.length=100),z._edges.add(V)}},relaxEdge:function(S){var j=S.t.p,b=S.s.p,a=S.t.d,T=S.s.d,E=j[0]-b[0],h=j[1]-b[1],F=j[2]-b[2],$=n(E*E+h*h+F*F),r=100*S.length,d=.25*E/r*$,w=.25*h/r*$,H=.25*F/r*$;a[0]-=d,a[1]-=w,a[2]-=H,T[0]+=d,T[1]+=w,T[2]+=H},relaxNode:function(m,w){if(m!==w){var j=m.p,x=w.p,i=0,R=0,p=0,U=j[0]-x[0],y=j[1]-x[1],c=j[2]-x[2],z=U*U+y*y+c*c;0===z?(i=e(),R=e(),p=e()):216e6>z&&(i=U/z,R=y/z,p=c/z);var a=m.r*w.r/400,E=m.d,f=w.d;i*=a,R*=a,p*=a,E[0]+=i,E[1]+=R,E[2]+=p,f[0]-=i,f[1]-=R,f[2]-=p}},moveNode:function(){var u=this,P=u._maxMotion,O=0,b=u._damper;u._nodes.each(function(z){if(!z.fix){var L=z.p,_=z.d,S=_[0]*b,y=_[1]*b,v=_[2]*b;_[0]=S/2,_[1]=y/2,_[2]=v/2,O=m(n(S*S+y*y+v*v),O),L[0]+=m(-40,f(40,S)),L[1]+=m(-40,f(40,y)),L[2]+=m(-40,f(40,v))}}),u._maxMotion=O,u._motionRatio=O>0?P/O-1:0,u.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);