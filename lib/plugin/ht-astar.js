!function(D,E,G){"use strict";var p=D.ht;p.Astar={},function(n){var X=n();D.AStar=X.astar,D.AStar.Graph=X.Graph}(function(){function I(p){for(var m=p,R=[];m.parent;)R.unshift(m),m=m.parent;return R}function F(){return new Y(function(l){return l.f})}function J(l,K){K=K||{},this.nodes=[],this.diagonal=!!K.diagonal,this.grid=[];for(var h=0;h<l.length;h++){this.grid[h]=[];for(var c=0,E=l[h];c<E.length;c++){var S=new X(h,c,E[c]);this.grid[h][c]=S,this.nodes.push(S)}}this.$13x()}function X(a,A,i){this.x=a,this.y=A,this.weight=i}function Y(Y){this.content=[],this.scoreFunction=Y}var V={search:function(e,s,$,M){e.$6x(),M=M||{};var L=M.heuristic;L||(L=e.diagonal?V.$4x.diagonal:V.$4x.manhattan);var w=M.closest||!1,Q=M.punish,m=F(),J=s;for(s.h=L(s,$),e.$7x(s),m.push(s);m.size()>0;){var o=m.pop();if(o===$)return I(o);o.closed=!0;for(var t=e.neighbors(o),Y=0,H=t.length;H>Y;++Y){var f=t[Y];if(!f.closed&&!f.$9x()){var l=o.g+f.getCost(o,Q),k=f.visited;(!k||l<f.g)&&(f.visited=!0,f.parent=o,f.h=f.h||L(f,$),f.g=l,f.f=f.g+f.h,e.$7x(f),w&&(f.h<J.h||f.h===J.h&&f.g<J.g)&&(J=f),k?m.$10x(f):m.push(f))}}}return w?I(J):[]},$4x:{manhattan:function(D,l){var t=Math.abs(l.x-D.x),W=Math.abs(l.y-D.y);return t+W},diagonal:function(I,i){var N=1,j=Math.sqrt(2),G=Math.abs(i.x-I.x),n=Math.abs(i.y-I.y);return N*(G+n)+(j-2*N)*Math.min(G,n)}},$5x:function(w){w.f=0,w.g=0,w.h=0,w.visited=!1,w.closed=!1,w.parent=null}};return J.prototype.$13x=function(){this.dirtyNodes=[];for(var m=0;m<this.nodes.length;m++)V.$5x(this.nodes[m])},J.prototype.$6x=function(){for(var d=0;d<this.dirtyNodes.length;d++)V.$5x(this.dirtyNodes[d]);this.dirtyNodes=[]},J.prototype.$7x=function(f){this.dirtyNodes.push(f)},J.prototype.neighbors=function(p){var J=[],a=p.x,t=p.y,r=this.grid;return r[a-1]&&r[a-1][t]&&J.push(r[a-1][t]),r[a+1]&&r[a+1][t]&&J.push(r[a+1][t]),r[a]&&r[a][t-1]&&J.push(r[a][t-1]),r[a]&&r[a][t+1]&&J.push(r[a][t+1]),this.diagonal&&(r[a-1]&&r[a-1][t-1]&&J.push(r[a-1][t-1]),r[a+1]&&r[a+1][t-1]&&J.push(r[a+1][t-1]),r[a-1]&&r[a-1][t+1]&&J.push(r[a-1][t+1]),r[a+1]&&r[a+1][t+1]&&J.push(r[a+1][t+1])),J},J.prototype.toString=function(){for(var f=[],r=this.grid,n=0;n<r.length;n++){for(var h=[],I=r[n],U=0;U<I.length;U++)h.push(I[U].weight);f.push(h.join(" "))}return f.join("\n")},X.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},X.prototype.getCost=function(y,z){var p;if(p=y&&y.x!=this.x&&y.y!=this.y?1.41421*this.weight:this.weight,z){var D=y;if(!D)return p;var u=D.parent;return u?Math.abs(u.x+this.x-2*D.x)>1e-5?p+z:Math.abs(u.y+this.y-2*D.y)>1e-5?p+z:p:p}},X.prototype.$9x=function(){return 0===this.weight},Y.prototype={push:function(z){this.content.push(z),this.$11x(this.content.length-1)},pop:function(){var V=this.content[0],W=this.content.pop();return this.content.length>0&&(this.content[0]=W,this.$12x(0)),V},remove:function(S){var u=this.content.indexOf(S),$=this.content.pop();u!==this.content.length-1&&(this.content[u]=$,this.scoreFunction($)<this.scoreFunction(S)?this.$11x(u):this.$12x(u))},size:function(){return this.content.length},$10x:function($){this.$11x(this.content.indexOf($))},$11x:function(P){for(var I=this.content[P];P>0;){var u=(P+1>>1)-1,B=this.content[u];if(!(this.scoreFunction(I)<this.scoreFunction(B)))break;this.content[u]=I,this.content[P]=B,P=u}},$12x:function(d){for(var V=this.content.length,v=this.content[d],Q=this.scoreFunction(v);;){var w,m=d+1<<1,H=m-1,e=null;if(V>H){var c=this.content[H];w=this.scoreFunction(c),Q>w&&(e=H)}if(V>m){var T=this.content[m],W=this.scoreFunction(T);(null===e?Q:w)>W&&(e=m)}if(null===e)break;this.content[d]=this.content[e],this.content[e]=v,d=e}}},{astar:V,Graph:J}});var d=p.Astar.Finder=function(n,e){var Y=this;Y.gv=n,Y.$13x(e),Y.refreshMap()};d.prototype={},d.prototype.constructor=d,E.defineProperties(d.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(f){this.gv._astarDebugInfo=f}}}),d.prototype.$13x=function(t){var w=this,a=w.$14x={};t=t||{};var B=t.gridSize||10;a.gridSizeX=t.gridSizeX||B,a.gridSizeY=t.gridSizeY||B,a.rect=t.rect,a.filter=t.filter,a.extendBlocks=t.extendBlocks||3,a.fastOverlap=t.fastOverlap===G?!0:t.fastOverlap,a.nodeRectExtend=t.nodeRectExtend||0,a.diagonal=t.diagonal===G?!0:t.diagonal,a.turnPunish=t.turnPunish===G?.1:t.turnPunish,a.simplify=t.simplify===G?!0:t.simplify,a.toGridCenter=t.toGridCenter===G?!1:t.toGridCenter,a.closest=t.closest===G?!0:t.closest},d.prototype.refreshMap=function(){var d,N=this,r=N.$14x,u=r.gridSizeX,L=r.gridSizeY,m=r.extendBlocks;r.rect?d=r.rect:(d=N.$15x(),p.Default.grow(d,u*m,L*m)),p.Default.grow(d,u,L);var g=Math.floor(d.x/u)*u,Y=Math.floor(d.y/L)*L,h=Math.ceil(d.width/u),O=Math.ceil(d.height/L),I=h*u,F=O*L;N.$16x={x:g,y:Y,w:I,h:F,gridX:u,gridY:L,xLen:h,yLen:O},N.$17x(),N.$21x()},d.prototype.$15x=function(){var B=this.gv;if(B instanceof p.graph.GraphView)return B.getContentRect();var l,X=p.Default.unionRect;return B.dm().each(function(S){B.isVisible(S)&&S.getRect&&(l=X(l,S.getRect()))}),l},d.prototype.$17x=function(){var N,F,x,U,O=this,X=O.$16x,i=X.xLen,b=X.yLen;for(N=new Array(i),x=0;i>x;x++)for(N[x]=F=new Array(b),U=b;U--;)F[U]=1;var p=O.$14x.filter;for(O.gv.dm().each(function(A){p&&p(A)===!1||(!O._debugInfo||A!==O._debugInfo.grid&&A!=O._debugInfo.path)&&O.$1cw(N,A)}),x=0;i>x;x++)N[x][0]=1,N[x][b-1]=1;for(U=0;b>U;U++)N[0][U]=1,N[i-1][U]=1;O.grid=N;var f=new AStar.Graph(N,{diagonal:O.$14x.diagonal});O.graph=f},d.prototype.$18x=function(j,I,y,e,V,_,T,P){var O=this.$19x,l=O(y-j,V-T,e-I,_-P);if(1e-6>=l&&l>=-1e-6)return!1;var G=O(V-j,V-T,_-I,_-P)/l;if(0>G||G>1)return!1;var p=O(y-j,V-j,e-I,_-I)/l;return 0>p||p>1?!1:!0},d.prototype.$19x=function(i,c,X,P){return i*P-c*X},d.prototype.$1aw=function(P,s,E,l){for(var _=[-(s[1]-P[1]),s[0]-P[0]],$=_[0]*(E[0]-P[0])+_[1]*(E[1]-P[1])>=0,G=0,C=l.length;C>G;G+=2)if(_[0]*(l[G]-P[0])+_[1]*(l[G+1]-P[1])>=0===$)return!1;return!0},d.prototype.$1bw=function(U,C){for(var A,o,f=this,L=0,y=U.length;y>L;L+=2)if(A=L===y-2?0:L+2,o=A===y-2?0:A+2,f.$1aw([U[L],U[L+1]],[U[A],U[A+1]],[U[o],U[o+1]],C))return!1;for(var L=0,y=C.length;y>L;L+=2)if(A=L===y-2?0:L+2,o=A===y-2?0:A+2,f.$1aw([C[L],C[L+1]],[C[A],C[A+1]],[C[o],C[o+1]],U))return!1;return!0},d.prototype.$1cw=function(_,e){if(e.getRect){var J=this,$=e.getRect();p.Default.grow($,J.$14x.nodeRectExtend);var t,m,f,c,b,s,B,D,L,V,o,H=J.$1dw({x:$.x,y:$.y}),v=J.$1dw({x:$.x+$.width,y:$.y+$.height}),Q=J.$14x.fastOverlap;if(!Q){var O=e.getCorners();B=[],O.forEach(function(P){B.push(P.x,P.y)}),V=J.$14x.gridSizeX/2,o=J.$14x.gridSizeY/2}for(m=Math.max(0,H.x),f=Math.min(v.x,_.length-1),b=Math.max(0,H.y),s=Math.min(v.y,_.length?_[0].length-1:-1),t=m;f>=t;t++)for(c=b;s>=c;c++)if(Q)_[t][c]=0;else{L=J.$1ew({x:t,y:c});var l=L.x-V,F=L.x+V,U=L.y-o,A=L.y+o;D=[l,U,l,A,F,A,F,U],J.$1bw(B,D)&&(_[t][c]=0)}}},d.prototype.$1dw=function($,q){var K=this,D=K.$16x,o=($.x-D.x)/D.gridX,Q=($.y-D.y)/D.gridY;return q!==!1&&(o=Math.round(o),Q=Math.round(Q)),{x:o,y:Q}},d.prototype.$1ew=function(y){var K=this,A=K.$16x;return{x:y.x*A.gridX+A.x,y:y.y*A.gridY+A.y}},d.prototype.$1fw=function(h){var _=this,Q=_.$16x,w=Q.xLen,f=Q.yLen;if(h.x>=0&&h.x<w&&h.y>=0&&h.y<f)return h;var v={x:h.x,y:h.y};return v.x<0?v.x=0:v.x>=w&&(v.x=w-1),v.y<0?v.y=0:v.y>=f&&(v.y=f-1),v},d.prototype.findPath=function(q,Q){var t,F,b,E,_=this,r=_.$1dw(q),d=_.$1dw(Q);if(b=_.$1fw(r),E=_.$1fw(d),b!==r&&E!==d){var Z=_.$16x,l=Z.x-Z.gridX/2,G=Z.y-Z.gridY/2,T=l+Z.gridX*Z.xLen,R=G+Z.gridY*Z.yLen;if(!(_.$18x(q.x,q.y,Q.x,Q.y,l,G,T,G)||_.$18x(q.x,q.y,Q.x,Q.y,T,G,T,R)||_.$18x(q.x,q.y,Q.x,Q.y,T,R,l,R)||_.$18x(q.x,q.y,Q.x,Q.y,l,R,l,G)))return[q,Q]}b!==r&&(t=!0,r=b),E!==d&&(F=!0,d=E);var u=_.graph.grid[r.x][r.y],I=_.graph.grid[d.x][d.y],P=AStar.search(_.graph,u,I,{closest:_.$14x.closest,punish:_.$14x.turnPunish});if(!P||!P.length)return null;var $=[];$.push(q),t&&$.push(_.$1ew(P[0]));for(var p=1,J=P.length;J-1>p;p++)$.push(_.$1ew(P[p]));if(F)$.push(_.$1ew(P[J-1])),$.push(Q);else{var w=P[J-1];d.x!==w.x||d.y!==w.y||_.$14x.toGridCenter?$.push(_.$1ew(w)):$.push(Q)}return _.$14x.simplify&&($=_.simplifyPath($)),_.$20x=$,_.$21x(),$},d.prototype.debugOn=function(A){this.debugFlag=!0,this.debugSettings=A||{},this.$21x()},d.prototype.simplifyPath=function(_){var j=_.length;if(2>=j)return _;var m,F,Z=[_[0],_[1]],w=Z[0],$=Z[1],R=1e-5;for(m=2;j>m;m++)F=_[m],Math.abs(($.x-w.x)*(F.y-w.y)-($.y-w.y)*(F.x-w.x))<R?$=Z[Z.length-1]=F:(w=$,$=F,Z.push(F));return Z},d.prototype.$21x=function(){var V=this;if(V.$22x(),this.debugFlag){var h=V.grid;if(h){var P,B=V.gv;if(V.debugSettings.$16x!==!1){P=[];for(var i,G,A,f,r,l=[],S=V.$14x.gridSizeX/2,Q=V.$14x.gridSizeY/2,$=h.length,_=$?h[0].length:0,x=1;$-1>x;x++)for(var T=1;_-1>T;T++)h[x][T]||(i=V.$1ew({x:x,y:T}),G=i.x-S,A=i.x+S,f=i.y-Q,r=i.y+Q,P.push({x:G,y:f},{x:G,y:r},{x:A,y:r},{x:A,y:f}),l.push(1,2,2,2,5));var M=new p.Shape;M.s("shape.border.color","rgba(50, 50, 50, 0.2)"),M.s("shape.border.width",1),M.s("shape.background","rgba(200, 50, 100, 0.2)"),M.s("2d.editable",!1),M.s("2d.selectable",!1),M.setPoints(P),M.setSegments(l),V._debugInfo={grid:M},B.dm().add(M)}V.debugSettings.path!==!1&&(P=new p.Shape,V.$20x&&(P.setPoints(V.$20x),P.s("shape.border.color","red"),P.s("shape.border.width",1),P.s("2d.editable",!1),P.s("2d.selectable",!1),P.s("shape.background",null),V._debugInfo||(V._debugInfo={}),V._debugInfo.path=P,B.dm().add(P)))}}},d.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},d.prototype.$22x=function(){var A=this;if(A._debugInfo){var E=A._debugInfo.grid,P=A._debugInfo.path,Y=A.gv;E&&Y.dm().remove(E),P&&Y.dm().remove(P),A._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);